.. include:: ../links.ref
.. _walkie-talkie:

**************
Walkie Talkie
**************

Arduino
========

推荐使用以下配置：

.. image:: ../../../doc/_static/arduino-setting.jpg

PlatformIO
===========

请参考 |platformio-using|_。

安装依赖
=========

T-TWR 支持以下版本的 arduino-esp32:

* |arduino-esp32|_

T-TWR 需要以下依赖库支持，用户可以用过库管理安装。

* |RotaryEncoder|_
* |OneButton|_
* |U8g2_Arduino|_
* |ArduinoJson|_

.. warning::

    如果出现编译错误，请先检查以上依赖是否一致。

频段选择
========

.. note::

    因为AT指令不能读取到 SA868 模块的频段信息，所以需要在源代码在手动选择频段。

``UHF_BAND`` 宏用于选择 UHF 频段，支持的频段范围是 400 ~ 480 MHz

.. literalinclude:: ../../../examples/walkie_talkie/config.h
    :linenos:
    :language: c
    :lines: 6-6
    :lineno-start: 6

``_350_BAND`` 宏用于选择 VHF 频段，支持的频段范围是 320 ~ 400 MHz

.. literalinclude:: ../../../examples/walkie_talkie/config.h
    :linenos:
    :language: c
    :lines: 11-11
    :lineno-start: 11

``VHF_BAND`` 宏用于选择 VHF 频段，支持的频段范围是 134 ~ 174 MHz

.. literalinclude:: ../../../examples/walkie_talkie/config.h
    :linenos:
    :language: c
    :lines: 16-16
    :lineno-start: 16

.. include:: ../datasheet.inc


Detailed Operation
===================

待更新。

引脚定义
========

=============== ==== ===================================================================================================
Name            Pin  Note
--------------- ---- ---------------------------------------------------------------------------------------------------
SA868_TX_PIN    47   Serial transmit data pin
--------------- ---- ---------------------------------------------------------------------------------------------------
SA868_RX_PIN    48   Serial receive data pin
--------------- ---- ---------------------------------------------------------------------------------------------------
SA868_PTT_PIN   41   SA868 Transmitting/receiving control, "0" force the module to enter TX state; and "1" to Rx state.
--------------- ---- ---------------------------------------------------------------------------------------------------
SA868_PD_PIN    40   Power Down control, "0" for power down mode; "1" for the normal work
--------------- ---- ---------------------------------------------------------------------------------------------------
SA868_RF_PIN    39   high/low output power control; Leave open for high output power, low level to low output power.
--------------- ---- ---------------------------------------------------------------------------------------------------
BUTTON_PTT_PIN  38   发射/接收按钮
--------------- ---- ---------------------------------------------------------------------------------------------------
BUTTON_UP_PIN   3    音量键加
--------------- ---- ---------------------------------------------------------------------------------------------------
BUTTON_DOWN_PIN 0    音量键减
--------------- ---- ---------------------------------------------------------------------------------------------------
ENCODER_A_PIN   9    编码器 Pin1
--------------- ---- ---------------------------------------------------------------------------------------------------
ENCODER_B_PIN   5    编码器 Pin2
--------------- ---- ---------------------------------------------------------------------------------------------------
ENCODER_OK_PIN  7    编码器确认按键
--------------- ---- ---------------------------------------------------------------------------------------------------
BATTERY_ADC_PIN 6    电池电压检测
--------------- ---- ---------------------------------------------------------------------------------------------------
OLED_POWER_PIN  21   OLED屏幕电源控制
--------------- ---- ---------------------------------------------------------------------------------------------------
LED_PIN         1    用户自定义指示灯
=============== ==== ===================================================================================================

Troubleshooting
================

如果出现故障，请先查阅 :ref:`故障排查 <troubleshooting>`。如果 :ref:`故障排查 <troubleshooting>` 不存在你遇到的问题，请通过 |github-issue|_ 获得技术支持。
